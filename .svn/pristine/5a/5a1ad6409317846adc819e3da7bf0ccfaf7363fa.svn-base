<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- ==========================================================  -->
<!-- Configuration for ibatis sqlmap mapping.                    -->
<!-- ==========================================================  -->

<!-- ============================================================================= -->
<!-- This file is generated by <tt>specialmer-dalgen</tt>, a DAL (Data Access Layer)  -->
<!-- code generation utility specially developed for <tt>rent</tt> project.     -->
<!--                                                                               -->
<!-- PLEASE DO NOT MODIFY THIS FILE MANUALLY, or else your modification may be     -->
<!-- OVERWRITTEN by someone else. To modify the file, you should go to directory   -->
<!-- <tt>(project-home)/biz/dal/src/conf/dalgen</tt>, and find the corresponding   -->
<!-- configuration files. Modify those files according to your needs, then run     -->
<!-- <tt>specialmer-dalgen</tt> to generate this file.                                -->
<!--                                                                               -->
<!-- @author peigen                                                             -->
<!-- ============================================================================= -->

<sqlMap namespace="specialmer">
    <!-- ============================================= -->
    <!-- RESULT MAPS                                   -->
    <!-- ============================================= -->

    <!-- result maps for database table user_points_detail -->
    <resultMap id="RM-USER-POINTS-DETAIL" class="com.yjf.esupplier.dal.dataobject.UserPointsDetailDO">
        <result property="pointsDetailId" column="points_detail_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="userId" column="user_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="valueType" column="value_type" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="pointsType" column="points_type" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="state" column="state" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="goods" column="goods" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="pointValue" column="point_value" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="pointBalance" column="point_balance" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="consumerPointValue" column="consumer_point_value" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="source" column="source" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="pointsRuleId" column="points_rule_id" javaType="long" jdbcType="BIGINT" nullValue="0"/>
        <result property="content" column="content" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="def1" column="def1" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="def2" column="def2" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="def3" column="def3" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="outBizNo" column="out_biz_no" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result property="rawAddTime" column="raw_add_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="rawUpdateTime" column="raw_update_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
    </resultMap>


    <!-- ============================================= -->
    <!-- mapped statements for IbatisUserPointsDetailDAO -->
    <!-- ============================================= -->
    <!-- mapped statement for IbatisUserPointsDetailDAO.insert -->
    <insert id="MS-USER-POINTS-DETAIL-INSERT">
    <![CDATA[
        insert /*MS-ESUPPLIER-USER-POINTS-DETAIL-INSERT*/ into user_points_detail(points_detail_id,user_id,value_type,points_type,state,goods,point_value,point_balance,consumer_point_value,source,points_rule_id,content,def1,def2,def3,out_biz_no,raw_add_time) values (#pointsDetailId#, #userId#, #valueType#, #pointsType#, #state#, #goods#, #pointValue#, #pointBalance#, #consumerPointValue#, #source#, #pointsRuleId#, #content#, #def1#, #def2#, #def3#, #outBizNo#, #rawAddTime#)
    ]]>
    </insert>

    <!-- mapped statement for IbatisUserPointsDetailDAO.update -->
    <update id="MS-USER-POINTS-DETAIL-UPDATE">
    <![CDATA[
        update /*MS-ESUPPLIER-USER-POINTS-DETAIL-UPDATE*/ user_points_detail set user_id=#userId#, value_type=#valueType#, points_type=#pointsType#, state=#state#, goods=#goods#, point_value=#pointValue#, point_balance=#pointBalance#, consumer_point_value=#consumerPointValue#, source=#source#, points_rule_id=#pointsRuleId#, content=#content#, def1=#def1#, def2=#def2#, def3=#def3#, out_biz_no=#outBizNo# where (points_detail_id = #pointsDetailId#)
    ]]>
    </update>

    <!-- mapped statement for IbatisUserPointsDetailDAO.findById -->
    <select id="MS-USER-POINTS-DETAIL-FIND-BY-ID" resultMap="RM-USER-POINTS-DETAIL">
    <![CDATA[
        select /*MS-ESUPPLIER-USER-POINTS-DETAIL-FIND-BY-ID*/ * from user_points_detail where (points_detail_id = #value#)
    ]]>
    </select>

    <!-- mapped statement for IbatisUserPointsDetailDAO.findByUserId -->
    <select id="MS-USER-POINTS-DETAIL-FIND-BY-USER-ID" resultMap="RM-USER-POINTS-DETAIL">
    <![CDATA[
        select /*MS-ESUPPLIER-USER-POINTS-DETAIL-FIND-BY-USER-ID*/ * from user_points_detail where (user_id = #value#) order by raw_add_time DESC
    ]]>
    </select>

    <!-- mapped statement for IbatisUserPointsDetailDAO.expirePointsByUserId -->
    <update id="MS-USER-POINTS-DETAIL-EXPIRE-POINTS-BY-USER-ID">
    <![CDATA[
        update /*MS-ESUPPLIER-USER-POINTS-DETAIL-EXPIRE-POINTS-BY-USER-ID*/ user_points_detail set state=#state# where ((value_type = 'POINT') AND (user_id = #userId#) AND (points_rule_id = #pointsRuleId#) AND (raw_add_time < #rawAddTime#))
    ]]>
    </update>

    <!-- mapped statement for IbatisUserPointsDetailDAO.deleteById -->
    <delete id="MS-USER-POINTS-DETAIL-DELETE-BY-ID">
    <![CDATA[
        delete /*MS-ESUPPLIER-USER-POINTS-DETAIL-DELETE-BY-ID*/ from user_points_detail where (points_detail_id = #value#)
    ]]>
    </delete>

    <!-- mapped statement for IbatisUserPointsDetailDAO.queryList -->
    <select id="MS-USER-POINTS-DETAIL-QUERY-LIST" resultMap="RM-USER-POINTS-DETAIL">
        SELECT /*MS-ESUPPLIER-USER-POINTS-DETAIL-QUERY-LIST*/  *  FROM user_points_detail where 1=1
			
				<dynamic>
				<isGreaterThan property="userPointsDetail.userId" compareValue="0"  prepend=" and ">
					<![CDATA[ user_id = #userPointsDetail.userId# ]]>
				</isGreaterThan>
			
				<isNotEmpty property="startAddTime" prepend=" and ">
				    <isEmpty property="endAddTime" >
					    <![CDATA[  raw_add_time < #startAddTime# ]]>
				    </isEmpty>
				</isNotEmpty>

				<isNotEmpty property="endAddTime" prepend=" and ">
				    <isEmpty property="startAddTime" >
					    <![CDATA[ raw_add_time > #endAddTime# ]]>
					</isEmpty>
				</isNotEmpty>

				<isNotEmpty property="endAddTime" prepend=" and ">
				    <isNotEmpty property="startAddTime" >
					    <![CDATA[ (raw_add_time < #startAddTime# or raw_add_time > #endAddTime#) ]]>
					</isNotEmpty>
				</isNotEmpty>
			
				<isNotEmpty property="userPointsDetail.pointsType" prepend=" and ">
					<![CDATA[ points_type = #userPointsDetail.pointsType# ]]>
				</isNotEmpty>

				<isNotEmpty property="userPointsDetail.valueType" prepend=" and ">
					<![CDATA[ value_type = #userPointsDetail.valueType# ]]>
				</isNotEmpty>

				<isNotEmpty property="userPointsDetail.outBizNo" prepend=" and ">
					<![CDATA[ out_biz_no = #userPointsDetail.outBizNo# ]]>
				</isNotEmpty>

				<isNotEmpty property="userPointsDetail.source" prepend=" and ">
					<![CDATA[ source = #userPointsDetail.source# ]]>
				</isNotEmpty>
			
				<isNotEmpty property="userPointsDetail.state" prepend=" and ">
					<![CDATA[ state = #userPointsDetail.state# ]]>
				</isNotEmpty>
				<isGreaterThan property="userPointsDetail.pointsRuleId" compareValue="0"  prepend=" and ">
						<![CDATA[ points_rule_id = #userPointsDetail.pointsRuleId# ]]>
				</isGreaterThan>
			</dynamic>
			<isNotEmpty property="addTimeAsc" >
					<![CDATA[ ORDER BY raw_add_time ASC LIMIT #limitStart#,#pageSize#;  ]]>
			</isNotEmpty>
			<isEmpty property="addTimeAsc" >
					<![CDATA[ ORDER BY raw_add_time DESC LIMIT #limitStart#,#pageSize#;  ]]>
			</isEmpty>
    </select>

    <!-- mapped statement for IbatisUserPointsDetailDAO.queryCount -->
    <select id="MS-USER-POINTS-DETAIL-QUERY-COUNT" resultClass="java.util.HashMap">
        select /*MS-ESUPPLIER-USER-POINTS-DETAIL-QUERY-COUNT*/  count(*) totalCount,sum(point_value-consumer_point_value) effectivePoint,sum(point_value) totalPoint from user_points_detail where 1=1
			
			<dynamic>
				<isGreaterThan property="userPointsDetail.userId" compareValue="0"  prepend=" and ">
					<![CDATA[ user_id = #userPointsDetail.userId# ]]>
				</isGreaterThan>
				
				<isNotEmpty property="startAddTime" prepend=" and ">
				    <isEmpty property="endAddTime" >
					    <![CDATA[  raw_add_time < #startAddTime# ]]>
				    </isEmpty>
				</isNotEmpty>

				<isNotEmpty property="endAddTime" prepend=" and ">
				    <isEmpty property="startAddTime" >
					    <![CDATA[ raw_add_time > #endAddTime# ]]>
					</isEmpty>
				</isNotEmpty>

				<isNotEmpty property="endAddTime" prepend=" and ">
				    <isNotEmpty property="startAddTime" >
					    <![CDATA[ (raw_add_time < #startAddTime# or raw_add_time > #endAddTime#) ]]>
					</isNotEmpty>
				</isNotEmpty>
			
				<isNotEmpty property="userPointsDetail.pointsType" prepend=" and ">
					<![CDATA[ points_type = #userPointsDetail.pointsType# ]]>
				</isNotEmpty>

				<isNotEmpty property="userPointsDetail.valueType" prepend=" and ">
					<![CDATA[ value_type = #userPointsDetail.valueType# ]]>
				</isNotEmpty>

				<isNotEmpty property="userPointsDetail.outBizNo" prepend=" and ">
					<![CDATA[ out_biz_no = #userPointsDetail.outBizNo# ]]>
				</isNotEmpty>
			
				<isNotEmpty property="userPointsDetail.source" prepend=" and ">
					<![CDATA[ source = #userPointsDetail.source# ]]>
				</isNotEmpty>
			
				<isNotEmpty property="userPointsDetail.state" prepend=" and ">
					<![CDATA[ state = #userPointsDetail.state# ]]>
				</isNotEmpty>
				<isGreaterThan property="userPointsDetail.pointsRuleId" compareValue="0"  prepend=" and ">
						<![CDATA[ points_rule_id = #userPointsDetail.pointsRuleId# ]]>
				</isGreaterThan>
			</dynamic>
    </select>

    <!-- mapped statement for IbatisUserPointsDetailDAO.findAllCount -->
    <select id="MS-USER-POINTS-DETAIL-FIND-ALL-COUNT" resultClass="long">
    <![CDATA[
        select /*MS-ESUPPLIER-USER-POINTS-DETAIL-FIND-ALL-COUNT*/ COUNT(*) from user_points_detail
    ]]>
    </select>

    <!-- mapped statement for IbatisUserPointsDetailDAO.findStatistic -->
    <select id="MS-USER-POINTS-DETAIL-FIND-STATISTIC" resultClass="long">
        select /*MS-ESUPPLIER-USER-POINTS-DETAIL-FIND-STATISTIC*/  sum(point_value-consumer_point_value) point_value from user_points_detail where 1=1
				<dynamic>
					<isGreaterThan property="userPointsDetail.pointsRuleId" compareValue="0"  prepend=" and ">
						<![CDATA[ points_rule_id = #userPointsDetail.pointsRuleId# ]]>
					</isGreaterThan>
					<isGreaterThan property="userPointsDetail.userId" compareValue="0"  prepend=" and ">
					<![CDATA[ user_id = #userPointsDetail.userId# ]]>
				</isGreaterThan>
				<isNotEmpty property="startAddTime" prepend=" and ">
				    <isEmpty property="endAddTime" >
					    <![CDATA[  raw_add_time < #startAddTime# ]]>
				    </isEmpty>
				</isNotEmpty>

				<isNotEmpty property="endAddTime" prepend=" and ">
				    <isEmpty property="startAddTime" >
					    <![CDATA[ raw_add_time > #endAddTime# ]]>
					</isEmpty>
				</isNotEmpty>

				<isNotEmpty property="endAddTime" prepend=" and ">
				    <isNotEmpty property="startAddTime" >
					    <![CDATA[ (raw_add_time < #startAddTime# or raw_add_time > #endAddTime#) ]]>
					</isNotEmpty>
				</isNotEmpty>
				<isNotEmpty property="userPointsDetail.pointsType" prepend=" and ">
					<![CDATA[ points_type = #userPointsDetail.pointsType# ]]>
				</isNotEmpty>

				<isNotEmpty property="userPointsDetail.valueType" prepend=" and ">
					<![CDATA[ value_type = #userPointsDetail.valueType# ]]>
				</isNotEmpty>

				<isNotEmpty property="userPointsDetail.outBizNo" prepend=" and ">
					<![CDATA[ out_biz_no = #userPointsDetail.outBizNo# ]]>
				</isNotEmpty>
					<isNotEmpty property="pointTypes" prepend=" and ">
						<![CDATA[ 
							points_type in
						]]>	 	
						<iterate property="pointTypes" open="(" close=")" conjunction=",">
							<![CDATA[ #pointTypes[]# ]]>	
						</iterate>
					</isNotEmpty>
					<isNotEmpty property="userPointsDetail.source" prepend=" and ">
						<![CDATA[ source = #userPointsDetail.source# ]]>
					</isNotEmpty>
					<isNotEmpty property="userPointsDetail.state" prepend=" and ">
						<![CDATA[ state = #userPointsDetail.state# ]]>
					</isNotEmpty>
				</dynamic>
    </select>

    <!-- mapped statement for IbatisUserPointsDetailDAO.insertAutotest -->
    <insert id="MS-USER-POINTS-DETAIL-INSERT-AUTOTEST">
    <![CDATA[
        insert /*MS-ESUPPLIER-USER-POINTS-DETAIL-INSERT-AUTOTEST*/ into user_points_detail(points_detail_id,user_id,value_type,points_type,state,goods,point_value,point_balance,source,points_rule_id,content,def1,def2,def3,out_biz_no,raw_add_time) values (#pointsDetailId#, #userId#, #valueType#, #pointsType#, #state#, #goods#, #pointValue#, #pointBalance#, #source#, #pointsRuleId#, #content#, #def1#, #def2#, #def3#, #outBizNo#, #rawAddTime#)
    ]]>
    </insert>

    <!-- mapped statement for IbatisUserPointsDetailDAO.findByUserIdAutotest -->
    <select id="MS-USER-POINTS-DETAIL-FIND-BY-USER-ID-AUTOTEST" resultMap="RM-USER-POINTS-DETAIL">
    <![CDATA[
        select /*MS-ESUPPLIER-USER-POINTS-DETAIL-FIND-BY-USER-ID-AUTOTEST*/ * from user_points_detail where (user_id = #value#) order by raw_add_time DESC
    ]]>
    </select>

    <!-- mapped statement for IbatisUserPointsDetailDAO.deleteByUserIdAutotest -->
    <delete id="MS-USER-POINTS-DETAIL-DELETE-BY-USER-ID-AUTOTEST">
    <![CDATA[
        delete /*MS-ESUPPLIER-USER-POINTS-DETAIL-DELETE-BY-USER-ID-AUTOTEST*/ from user_points_detail where (user_id = #value#)
    ]]>
    </delete>

</sqlMap>
